var updateValuesTimeout;function loadDeviceSearchResults(e){let t=e.find('.input[data-type="search"]'),a=e.attr("data-search-handler"),i=t.val(),s=`${homePi.data.webroot}/assets/device_handlers/public/${a}/search.php?id=${e.attr("data-id")}&value=${i}`;t.parent().showLoading(),$.get(s,(function(e){t.parent().hideLoading();try{if(1!=(e=JSON.parse(e)).success)throw e.message;t.clearResults(),$.each(e.results,(function(e,a){t.appendResult(a.value,a.title,a.title,a.description,a.thumbnail)}))}catch(e){sendMessage(l("generic.error"),[],!0)}}))}function setDeviceValue(e,t,a){e.attr("data-value-updating-disabled","true");let i=e.attr("data-control-type"),s=e.find(".device-name"),o=s.text(),d=e.attr("data-id");e.attr("data-handler");s.showLoading(),void 0===a&&(a=t);let c={id:d,value:t,shown_value:a,force_set:e.attr("data-force-set")};homePi.api.call("device-set-value",c).then((()=>{e.attr("data-value-updating-disabled","false"),s.hideLoading(),"toggle"==i?homePi.message.send(homePi.locale.translate(`devices.message.toggled_${t}_success`,[o])):homePi.message.send(homePi.locale.translate("devices.message.changed_success",[o,a]))})).catch((()=>{e.attr("data-value-updating-disabled","false"),s.hideLoading(),"toggle"==i?homePi.message.error(homePi.locale.translate(`devices.error.toggled_${t}_error`,[o])):homePi.message.error(homePi.locale.translate("devices.error.changed_error",[o,a]))}))}function toggleFavorite(e){"true"==e.attr("data-favorite")?e.attr("data-favorite","false"):e.attr("data-favorite","true"),saveFavoriteDevicesList()}function saveFavoriteDevicesList(){let e=[];$('.device[data-favorite="true"]').each((function(){e.push($(this).attr("data-id"))})),e=e.join(","),saveState("devices_favorite",e)}homePi_assign("devices",{updateValuesLoop:(e=1e3)=>{homePi.devices.updateValues(),updateValuesTimeout=setTimeout((()=>{homePi.devices.updateValuesLoop(e)}),e)},updateValues:()=>{homePi.api.call("devices-get-values",{}).then((e=>{$.each(e.data,(function(e,t){const a=$(`.device[data-id="${e}"]`);return 0==a.length||(a.attr("data-value")==t.value||("true"==a.attr("data-value-updating-disabled")||(a.find(".device-control").value(t.value,t.shown_value),void a.attr("data-value",t.value))))}))}))}}),$(document).on("homepi.ready",(()=>{"devices/main"!=homePi.page.current()&&clearTimeout(updateValuesTimeout),homePi.devices.updateValuesLoop()})),$(document).ready((function(){$(".range-thumb").on("touchstart",(function(){$(this).siblings(".range-tooltip").css("opacity",1)})).on("touchend",(function(){$(this).siblings(".range-tooltip").css("opacity",0)}))})),$(document).on("input",'.device-control[data-type="range"]',(function(){$(this).parents(".device").attr("data-value-updating-disabled","true")})),$(document).on("click",".categories-list-row",debounce((function(){let e=[];$(".categories-list-row").find(".category-button").each((function(){$(this).hasClass("active")||e.push($(this).attr("data-category"))})),homePi.users.currentUser.setSetting("devices_inactive_categories",e).then((()=>{homePi.page.reload()})).catch()}),500)),$(document).on("homepi.search_value_change",'.device .input[data-type="search"]',(function(){let e=$(this);setDeviceValue(e.parents(".device"),e.getValue(),e.getShownValue())})),$(document).on("change",'.device .device-control:not([data-type="search"])',(function(){let e=$(this),t=e.parents(".device"),a=e.value();setDeviceValue(t,a,a)}));